#Домашнее задание к занятию "08.01 Введение в Ansible"

###1. Попробуйте запустить playbook на окружении из test.yml, зафиксируйте какое значение имеет факт some_fact для указанного хоста при выполнении playbook'a.
Ответ: 12.

<details><summary>Вот так отработала команда:</summary> 

```text
[cats@host-63 playbook]$ ansible-playbook -i inventory/test.yml site.yml

PLAY [Print os facts] *********************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************************************
[WARNING]: Platform linux on host localhost is using the discovered Python interpreter at /usr/bin/python3.9, but future installation of another Python interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-core/2.12/reference_appendices/interpreter_discovery.html for more information.
ok: [localhost]

TASK [Print OS] ***************************************************************************************************************************************************************************************************************************
ok: [localhost] => {
    "msg": "Altlinux"
}

TASK [Print fact] *************************************************************************************************************************************************************************************************************************
ok: [localhost] => {
    "msg": 12
}

PLAY RECAP ********************************************************************************************************************************************************************************************************************************
localhost                  : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
```
</details>

###2. Найдите файл с переменными (group_vars) в котором задаётся найденное в первом пункте значение и поменяйте его на 'all default fact'.
Ответ:
Файлик `group_vars/all/examp.yml` теперь выглядит так:
```text
---
  some_fact: "all default fact" 
```

###3. Воспользуйтесь подготовленным (используется docker) или создайте собственное окружение для проведения дальнейших испытаний.
Ответ:
```text
[cats@host-63 playbook]$ docker ps
CONTAINER ID   IMAGE      COMMAND       CREATED      STATUS          PORTS     NAMES
0977492d043f   ubuntu     "bash"        2 days ago   Up 10 seconds             ubuntu
25828ea7bfdb   centos:7   "/bin/bash"   2 days ago   Up 3 seconds              centos7
```

###4. Проведите запуск playbook на окружении из prod.yml. Зафиксируйте полученные значения some_fact для каждого из managed host.
Ответ: для centos7 - "el", для ubuntu - "deb"

<details><summary>Вот так отработала команда:</summary> 

```text
[cats@host-63 playbook]$ ansible-playbook -i inventory/prod.yml site.yml 

PLAY [Print os facts] *********************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************************************
[WARNING]: Distribution Ubuntu 20.04 on host ubuntu should use /usr/bin/python3, but is using /usr/bin/python2.7, since the discovered platform python interpreter was not present. See https://docs.ansible.com/ansible-
core/2.12/reference_appendices/interpreter_discovery.html for more information.
ok: [ubuntu]
ok: [centos7]

TASK [Print OS] ***************************************************************************************************************************************************************************************************************************
ok: [centos7] => {
    "msg": "CentOS"
}
ok: [ubuntu] => {
    "msg": "Ubuntu"
}

TASK [Print fact] *************************************************************************************************************************************************************************************************************************
ok: [centos7] => {
    "msg": "el"
}
ok: [ubuntu] => {
    "msg": "deb"
}

PLAY RECAP ********************************************************************************************************************************************************************************************************************************
centos7                    : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
ubuntu                     : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
```
</details>

###5. Добавьте факты в group_vars каждой из групп хостов так, чтобы для some_fact получились следующие значения: для deb - 'deb default fact', для el - 'el default fact'.
Ответ:
Файлик `group_vars/deb/examp.yml` теперь выглядит так:
```text
---
  some_fact: "deb default fact"
```

Файлик `group_vars/el/examp.yml` теперь выглядит так:
```text
---
  some_fact: "el default fact"
```

###6. Повторите запуск playbook на окружении prod.yml. Убедитесь, что выдаются корректные значения для всех хостов.
Ответ:
<details><summary>Вот так отработала команда:</summary> 

```text
[cats@host-63 playbook]$ ansible-playbook -i inventory/prod.yml site.yml 

PLAY [Print os facts] *********************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************************************
[WARNING]: Distribution Ubuntu 20.04 on host ubuntu should use /usr/bin/python3, but is using /usr/bin/python2.7, since the discovered platform python interpreter was not present. See https://docs.ansible.com/ansible-
core/2.12/reference_appendices/interpreter_discovery.html for more information.
ok: [ubuntu]
ok: [centos7]

TASK [Print OS] ***************************************************************************************************************************************************************************************************************************
ok: [centos7] => {
    "msg": "CentOS"
}
ok: [ubuntu] => {
    "msg": "Ubuntu"
}

TASK [Print fact] *************************************************************************************************************************************************************************************************************************
ok: [centos7] => {
    "msg": "el default fact"
}
ok: [ubuntu] => {
    "msg": "deb default fact"
}

PLAY RECAP ********************************************************************************************************************************************************************************************************************************
centos7                    : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
ubuntu                     : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

```
</details>

###7. При помощи ansible-vault зашифруйте факты в group_vars/deb и group_vars/el с паролем netology.
Ответ:
Вот group/deb/examp.yml:
```text
$ANSIBLE_VAULT;1.1;AES256
31616238343437386162653231383139626165626563326330633233663936613531313762656632
3139313035373131623332626138386135343035616164370a306364303265323062623463626661
37653461323561653133636538386337376632366161626564343763376431313162373538303137
6463383637333934660a323935623238303532643762306163613330356633653366633734393565
61666334346234393561303839366633376234623362353935653961663161653437353262636363
3633653536363634336336656166383364353631363431613537
```

А вот group/el/examp.yml:
```text
$ANSIBLE_VAULT;1.1;AES256
61383334313838623731653063363934336135333165396234653061353430316533346633343535
3266623032363631366635313937393634333333386339300a393433396266303465363531333138
34363364373433633036396137333335343637373161626662653331323136373435373832376134
3736396263613364340a666332313836636134663131646239643836366137323833626432343366
32343539666561366630346135363739666232663362333738356564616135353833663764643431
3561656632373138616666336636373963396565643338623935
```

###8. Запустите playbook на окружении prod.yml. При запуске ansible должен запросить у вас пароль. Убедитесь в работоспособности.
Ответ:
<details><summary>Вот так отработала команда:</summary> 

```text
[cats@host-63 playbook]$ ansible-playbook -i inventory/prod.yml site.yml --ask-vault-pass
Vault password: 

PLAY [Print os facts] *********************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************************************
[WARNING]: Distribution Ubuntu 20.04 on host ubuntu should use /usr/bin/python3, but is using /usr/bin/python2.7, since the discovered platform python interpreter was not present. See https://docs.ansible.com/ansible-
core/2.12/reference_appendices/interpreter_discovery.html for more information.
ok: [ubuntu]
ok: [centos7]

TASK [Print OS] ***************************************************************************************************************************************************************************************************************************
ok: [centos7] => {
    "msg": "CentOS"
}
ok: [ubuntu] => {
    "msg": "Ubuntu"
}

TASK [Print fact] *************************************************************************************************************************************************************************************************************************
ok: [centos7] => {
    "msg": "el default fact"
}
ok: [ubuntu] => {
    "msg": "deb default fact"
}

PLAY RECAP ********************************************************************************************************************************************************************************************************************************
centos7                    : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
ubuntu                     : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
```
</details>

###9. Посмотрите при помощи ansible-doc список плагинов для подключения. Выберите подходящий для работы на control node.
Ответ:
Список подключенных плагинов, список всех плагинов посмотрел. Только не понял, как выбрать из этой кучи тот, который подходит для работы на control node. Объясните, пожалуйста.

###10. В prod.yml добавьте новую группу хостов с именем local, в ней разместите localhost с необходимым типом подключения.
Ответ:
Файлик `inventory/prod.yml` теперь выглядит так:
```text
---
  el:
    hosts:
      centos7:
        ansible_connection: docker
  deb:
    hosts:
      ubuntu:
        ansible_connection: docker
  local:
    hosts:
      localhost:
        ansible_connection: local
```

###11. Запустите playbook на окружении prod.yml. При запуске ansible должен запросить у вас пароль. Убедитесь что факты some_fact для каждого из хостов определены из верных group_vars.
Ответ:
<details><summary>Вот так отработала команда:</summary> 

```text
[cats@host-63 playbook]$ ansible-playbook -i inventory/prod.yml site.yml --ask-vault-pass
Vault password: 

PLAY [Print os facts] *********************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************************************
[WARNING]: Distribution Ubuntu 20.04 on host ubuntu should use /usr/bin/python3, but is using /usr/bin/python2.7, since the discovered platform python interpreter was not present. See https://docs.ansible.com/ansible-
core/2.12/reference_appendices/interpreter_discovery.html for more information.
ok: [ubuntu]
ok: [centos7]
[WARNING]: Platform linux on host localhost is using the discovered Python interpreter at /usr/bin/python3.9, but future installation of another Python interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-core/2.12/reference_appendices/interpreter_discovery.html for more information.
ok: [localhost]

TASK [Print OS] ***************************************************************************************************************************************************************************************************************************
ok: [localhost] => {
    "msg": "Altlinux"
}
ok: [centos7] => {
    "msg": "CentOS"
}
ok: [ubuntu] => {
    "msg": "Ubuntu"
}

TASK [Print fact] *************************************************************************************************************************************************************************************************************************
ok: [localhost] => {
    "msg": "all default fact"
}
ok: [centos7] => {
    "msg": "el default fact"
}
ok: [ubuntu] => {
    "msg": "deb default fact"
}

PLAY RECAP ********************************************************************************************************************************************************************************************************************************
centos7                    : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
localhost                  : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
ubuntu                     : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
```
</details>

#Необязательная часть

###При помощи ansible-vault расшифруйте все зашифрованные файлы с переменными.
###Зашифруйте отдельное значение PaSSw0rd для переменной some_fact паролем netology. Добавьте полученное значение в group_vars/all/exmp.yml.
###Запустите playbook, убедитесь, что для нужных хостов применился новый fact.
Ответ: вот такой group_vars/all/examp.yml
```text
---
  some_fact: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          63373864353438323261333530393634316666663938396336636235356464626231343061363462
          3161653735316363386237343039626139643262636534620a346361666664663031623130623431
          62383565633538373764393333393363663763643332383638306337303361383838366364303635
          6166303064373234660a346431393332303433633330626665393539326466366636373664303831
          3234
```

<details><summary>Вот так отработала команда:</summary> 

```text
(venv) [cats@host-63 playbook]$ ansible-playbook -i inventory/prod.yml site.yml --ask-vault-pass
Vault password: 

PLAY [Print os facts] *********************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************************************
ok: [centos7]
[WARNING]: Platform linux on host localhost is using the discovered Python interpreter at /home/cats/Документы/GIT/8.1_ansible/venv/bin/python3.9, but future installation of another Python interpreter could change the meaning of that
path. See https://docs.ansible.com/ansible-core/2.12/reference_appendices/interpreter_discovery.html for more information.
ok: [localhost]
[WARNING]: Distribution Ubuntu 20.04 on host ubuntu should use /usr/bin/python3, but is using /usr/bin/python2.7, since the discovered platform python interpreter was not present. See https://docs.ansible.com/ansible-
core/2.12/reference_appendices/interpreter_discovery.html for more information.
ok: [ubuntu]

TASK [Print OS] ***************************************************************************************************************************************************************************************************************************
ok: [localhost] => {
    "msg": "Altlinux"
}
ok: [centos7] => {
    "msg": "CentOS"
}
ok: [ubuntu] => {
    "msg": "Ubuntu"
}

TASK [Print fact] *************************************************************************************************************************************************************************************************************************
ok: [localhost] => {
    "msg": "PaSSw0rd"
}
ok: [centos7] => {
    "msg": "el default fact"
}
ok: [ubuntu] => {
    "msg": "deb default fact"
}

PLAY RECAP ********************************************************************************************************************************************************************************************************************************
centos7                    : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
localhost                  : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
ubuntu                     : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

```
</details>

###Добавьте новую группу хостов fedora, самостоятельно придумайте для неё переменную.
Ответ:
```text
(venv) [cats@host-63 playbook]$ docker ps
CONTAINER ID   IMAGE      COMMAND       CREATED          STATUS         PORTS     NAMES
e43808cfdb32   fedora     "/bin/bash"   25 seconds ago   Up 2 seconds             fedora
0977492d043f   ubuntu     "bash"        3 days ago       Up 7 minutes             ubuntu
25828ea7bfdb   centos:7   "/bin/bash"   3 days ago       Up 7 minutes             centos7
```


<details><summary>Вот так отработала команда:</summary> 

```text
(venv) [cats@host-63 playbook]$ ansible-playbook -i inventory/prod.yml site.yml --ask-vault-pass
Vault password: 

PLAY [Print os facts] *********************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************************************
ok: [fedora]
[WARNING]: Distribution Ubuntu 20.04 on host ubuntu should use /usr/bin/python3, but is using /usr/bin/python2.7, since the discovered platform python interpreter was not present. See https://docs.ansible.com/ansible-
core/2.12/reference_appendices/interpreter_discovery.html for more information.
ok: [ubuntu]
ok: [centos7]
[WARNING]: Platform linux on host localhost is using the discovered Python interpreter at /home/cats/Документы/GIT/8.1_ansible/venv/bin/python3.9, but future installation of another Python interpreter could change the meaning of that
path. See https://docs.ansible.com/ansible-core/2.12/reference_appendices/interpreter_discovery.html for more information.
ok: [localhost]

TASK [Print OS] ***************************************************************************************************************************************************************************************************************************
ok: [localhost] => {
    "msg": "Altlinux"
}
ok: [centos7] => {
    "msg": "CentOS"
}
ok: [ubuntu] => {
    "msg": "Ubuntu"
}
ok: [fedora] => {
    "msg": "Fedora"
}

TASK [Print fact] *************************************************************************************************************************************************************************************************************************
ok: [localhost] => {
    "msg": "PaSSw0rd"
}
ok: [centos7] => {
    "msg": "el default fact"
}
ok: [ubuntu] => {
    "msg": "deb default fact"
}
ok: [fedora] => {
    "msg": "fed default fact"
}

PLAY RECAP ********************************************************************************************************************************************************************************************************************************
centos7                    : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
fedora                     : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
localhost                  : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
ubuntu                     : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
```
</details>